/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var q=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var ce=Object.prototype.hasOwnProperty;var de=(o,n)=>{for(var e in n)q(o,e,{get:n[e],enumerable:!0})},pe=(o,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of le(n))!ce.call(o,s)&&s!==e&&q(o,s,{get:()=>n[s],enumerable:!(t=ae(n,s))||t.enumerable});return o};var ue=o=>pe(q({},"__esModule",{value:!0}),o);var fe={};de(fe,{default:()=>B});module.exports=ue(fe);var T=require("obsidian");var K=!1;function _(o){K=!!o}function M(o,...n){K&&console.log(`[TPS Notifier] ${o}`,...n)}function C(o,...n){console.error(`[TPS Notifier] ${o}`,...n)}var v=require("obsidian");var I=require("obsidian"),A=class extends I.Modal{constructor(e,t,s){super(e);this.customMinutes=null;this.onSubmit=t,this.options=Array.isArray(s)?s:[]}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Snooze Reminder"});let t=e.createDiv({cls:"tps-snooze-buttons"});t.style.display="flex",t.style.flexDirection="column",t.style.gap="10px";let s=[{label:"15 Minutes",value:15},{label:"1 Hour",value:60},{label:"4 Hours",value:240},{label:"1 Day",value:1440}];(this.options.length>0?this.options.map(l=>({label:l.label,value:l.minutes})):s).forEach(l=>{new I.Setting(t).setName(l.label).addButton(u=>u.setButtonText("Select").onClick(()=>{this.handleSelection(l.value)}))});let r=e.createDiv({cls:"tps-snooze-custom"});r.style.marginTop="15px",r.style.borderTop="1px solid var(--background-modifier-border)",r.style.paddingTop="10px",new I.Setting(r).setName("Custom Duration").setDesc("Enter minutes").addText(l=>l.setPlaceholder("e.g. 30").onChange(u=>{let c=parseInt(u);this.customMinutes=isNaN(c)?null:c})).addButton(l=>l.setButtonText("Snooze").setCta().onClick(()=>{this.customMinutes&&this.customMinutes>0?this.handleSelection(this.customMinutes):new I.Notice("Please enter a valid number of minutes.")}))}handleSelection(e){let t=0;typeof e=="number"&&(t=e),this.onSubmit(t),this.close()}onClose(){let{contentEl:e}=this;e.empty()}};var z="tps-notification-view",L=class extends v.ItemView{constructor(e,t){super(e);this.items=[];this.plugin=t,this.refreshDebounced=(0,v.debounce)(()=>{this.refresh()},120,!1)}getViewType(){return z}getDisplayText(){return"Notifications"}getIcon(){return"bell"}async onOpen(){this.addAction("refresh-cw","Refresh Notifications",async()=>{await this.refresh()}),this.registerEvent(this.app.metadataCache.on("changed",e=>{e instanceof v.TFile&&this.items.some(t=>t.file.path===e.path)&&this.refreshDebounced()})),this.registerEvent(this.app.vault.on("delete",e=>{e instanceof v.TFile&&this.items.some(t=>t.file.path===e.path)&&this.refreshDebounced()})),this.registerEvent(this.app.vault.on("rename",e=>{e instanceof v.TFile&&this.refreshDebounced()})),this.registerEvent(this.app.workspace.on("tps-gcm-files-updated",e=>{if(!Array.isArray(e)||e.length===0)return;let t=new Set(e);this.items.some(s=>t.has(s.file.path))&&this.refresh()})),await this.refresh(),this.registerInterval(window.setInterval(()=>this.refreshDebounced(),15e3))}async refresh(){this.items=await this.plugin.getOverdueItems(),this.draw()}draw(){let e=this.contentEl;e.empty(),e.addClass("tps-notification-view");let t=e.createDiv({cls:"tps-notification-list"});if(t.style.display="flex",t.style.flexDirection="column",t.style.height="100%",t.style.overflowY="auto",this.items.length===0){let s=t.createDiv({cls:"tps-empty-state"});s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.justifyContent="center",s.style.height="100%",s.style.color="var(--text-muted)",s.style.padding="20px";let i=s.createDiv();(0,v.setIcon)(i,"check-circle"),i.style.marginBottom="8px",i.style.opacity="0.5",s.createDiv({text:"All caught up!"});return}for(let s of this.items){let i=t.createDiv({cls:"tps-notification-item"});i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="space-between",i.style.padding="8px 12px",i.style.borderBottom="1px solid var(--background-modifier-border)",i.style.cursor="pointer",i.style.gap="12px",i.style.transition="background-color 0.1s ease",i.addEventListener("mouseenter",()=>{i.style.backgroundColor="var(--background-modifier-hover)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor="transparent"}),i.addEventListener("click",h=>{h.target.closest(".tps-notification-actions")||this.plugin.openFile(s.file)}),i.addEventListener("contextmenu",h=>{h.preventDefault(),h.stopPropagation(),this.showContextMenu(h,s)});let r=i.createDiv({cls:"tps-notification-content"});r.style.display="flex",r.style.flexDirection="column",r.style.flex="1",r.style.overflow="hidden";let l=r.createDiv({cls:"tps-notification-top"});l.style.display="flex",l.style.alignItems="baseline",l.style.gap="8px",l.style.marginBottom="2px";let u=s.title||s.file.basename,c=l.createEl("span",{text:u});c.style.fontWeight="600",c.style.color="var(--text-normal)",c.style.fontSize="0.9em",c.style.whiteSpace="nowrap",c.style.overflow="hidden",c.style.textOverflow="ellipsis";let p=s.snoozedUntil?`Snoozed until ${(0,v.moment)(s.snoozedUntil).format("HH:mm")}`:s.diff,f=l.createEl("span",{text:p});f.style.fontSize="0.75em",f.style.color=s.snoozedUntil?"var(--text-accent)":"var(--text-muted)",f.style.flexShrink="0";let a=r.createDiv({cls:"tps-notification-body"});a.setText(s.body||s.reminder.property),a.style.fontSize="0.8em",a.style.color="var(--text-muted)",a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.textOverflow="ellipsis",s.snoozedUntil&&(i.style.opacity="0.5");let d=i.createDiv({cls:"tps-notification-actions"});d.style.display="flex",d.style.alignItems="center",d.style.gap="4px";let g=(h,P,E)=>{let m=d.createDiv({cls:"tps-icon-btn"});return(0,v.setIcon)(m,h),m.setAttribute("aria-label",P),m.style.padding="6px",m.style.borderRadius="4px",m.style.color="var(--text-muted)",m.style.display="flex",m.style.alignItems="center",m.addEventListener("mouseenter",()=>{m.style.backgroundColor="var(--background-modifier-hover)",m.style.color="var(--text-normal)"}),m.addEventListener("mouseleave",()=>{m.style.backgroundColor="transparent",m.style.color="var(--text-muted)"}),m.addEventListener("click",R=>{R.stopPropagation(),E(R)}),m};g("clock","Snooze",h=>{new A(this.app,async P=>{await this.plugin.snoozeFile(s.file,P),await this.refresh()},this.plugin.settings.snoozeOptions||[]).open()}),g("check","Mark Complete",async h=>{await this.plugin.markFileComplete(s.file),await this.refresh()}),g("x","Mark Won't Do",async h=>{await this.plugin.markFileWontDo(s.file),await this.refresh()})}}showContextMenu(e,t){let s=new v.Menu;this.app.workspace.trigger("file-menu",s,t.file,"tps-notification-view",this.leaf),s.showAtMouseEvent(e)}};var N=require("obsidian"),H=class extends N.Modal{constructor(e,t){super(e);this.items=[];this.plugin=t,this.refreshDebounced=(0,N.debounce)(this.refresh.bind(this),300,!0)}async onOpen(){let{contentEl:e,titleEl:t}=this;t.setText("Overdue Items"),this.container=e.createDiv(),this.container.style.maxHeight="400px",this.container.style.overflowY="auto",await this.refresh(),this.plugin.registerEvent(this.app.metadataCache.on("changed",s=>{this.refreshDebounced()}))}onClose(){let{contentEl:e}=this;e.empty()}async refresh(){this.items=await this.plugin.getOverdueItems(),this.render()}render(){if(this.container.empty(),this.titleEl.setText(`Overdue Items (${this.items.length})`),this.items.length===0){this.container.createEl("div",{text:"No overdue items.",cls:"tps-overdue-empty"});return}for(let e of this.items){let t=this.container.createDiv({cls:"tps-overdue-item"});t.style.padding="8px",t.style.borderBottom="1px solid var(--background-modifier-border)",t.style.cursor="pointer",e.snoozedUntil&&(t.style.opacity="0.5");let s=t.createEl("div",{text:e.file.basename});s.style.fontWeight="600";let i=e.snoozedUntil?`Snoozed until ${(0,N.moment)(e.snoozedUntil).format("HH:mm")}`:`${e.reminder.property}: ${e.diff}`,r=t.createEl("div",{text:i});r.style.fontSize="0.85em",r.style.color=e.snoozedUntil?"var(--text-accent)":"var(--text-muted)";let l=t.createDiv({cls:"tps-overdue-actions"});l.style.display="flex",l.style.gap="8px",l.style.marginTop="4px",l.style.alignItems="center";let u=(p,f,a)=>{let d=l.createDiv({cls:"tps-icon-btn"});return(0,N.setIcon)(d,p),d.setAttribute("aria-label",f),d.style.padding="4px",d.style.borderRadius="4px",d.style.color="var(--text-muted)",d.style.display="flex",d.style.alignItems="center",d.style.cursor="pointer",d.addEventListener("mouseenter",()=>{d.style.backgroundColor="var(--background-modifier-hover)",d.style.color="var(--text-normal)"}),d.addEventListener("mouseleave",()=>{d.style.backgroundColor="transparent",d.style.color="var(--text-muted)"}),d.addEventListener("click",g=>{g.stopPropagation(),a(g)}),d};u("check","Mark Complete",async p=>{await this.plugin.markFileComplete(e.file),await this.refresh()}),u("x","Mark Won't Do",async p=>{await this.plugin.markFileWontDo(e.file),await this.refresh()}),l.createEl("button",{text:"Open Note"}).addEventListener("click",p=>{p.stopPropagation(),this.app.workspace.openLinkText(e.file.path,"",!1)})}}};var S=require("obsidian"),$=class extends S.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"TPS Notifier Settings"});let t=(a,d=!1)=>{let g=e.createEl("details",{cls:"tps-notifier-settings-group"});g.style.border="1px solid var(--background-modifier-border)",g.style.borderRadius="6px",g.style.padding="10px",g.style.marginBottom="10px",d&&g.setAttr("open","");let h=g.createEl("summary",{text:a});return h.style.fontWeight="bold",h.style.cursor="pointer",h.style.marginBottom="10px",g.createDiv({cls:"tps-notifier-settings-group-content"})},s=t("Connection",!0);new S.Setting(s).setName("ntfy Server").setDesc("The ntfy server URL (e.g., https://ntfy.sh)").addText(a=>a.setPlaceholder("https://ntfy.sh").setValue(this.plugin.settings.ntfyServer).onChange(async d=>{this.plugin.settings.ntfyServer=d,await this.plugin.saveSettings()})),new S.Setting(s).setName("ntfy Topic").setDesc("Your unique topic name").addText(a=>a.setPlaceholder("my-reminders").setValue(this.plugin.settings.ntfyTopic).onChange(async d=>{this.plugin.settings.ntfyTopic=d,await this.plugin.saveSettings()})),new S.Setting(s).setName("Priority").setDesc("Notification priority (1-5)").addSlider(a=>a.setLimits(1,5,1).setValue(this.plugin.settings.ntfyPriority).setDynamicTooltip().onChange(async d=>{this.plugin.settings.ntfyPriority=d,await this.plugin.saveSettings()}));let i=t("Snooze",!1);new S.Setting(i).setName("Snooze Property").setDesc("Frontmatter property name for snooze time (e.g., reminderSnooze, snooze)").addText(a=>a.setPlaceholder("reminderSnooze").setValue(this.plugin.settings.snoozeProperty||"reminderSnooze").onChange(async d=>{this.plugin.settings.snoozeProperty=d.trim()||"reminderSnooze",await this.plugin.saveSettings()}));let r=i.createEl("details");r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="6px",r.style.padding="8px 10px",r.style.marginBottom="10px";let l=r.createEl("summary",{text:"Snooze Presets"});l.style.fontWeight="600",l.style.cursor="pointer";let u=r.createDiv({cls:"tps-notifier-snooze-options"});u.style.marginTop="8px",this.renderSnoozeOptions(u),new S.Setting(u).addButton(a=>a.setButtonText("Add Preset").setCta().onClick(async()=>{Array.isArray(this.plugin.settings.snoozeOptions)||(this.plugin.settings.snoozeOptions=[]),this.plugin.settings.snoozeOptions.push({label:"15 Minutes",minutes:15}),await this.plugin.saveSettings(),this.renderSnoozeOptions(u)}));let p=t("Reminders",!1).createDiv();p.style.padding="10px",p.style.color="var(--text-muted)",p.innerHTML=`
            <p>Reminder rules are now managed by the <strong>TPS-Controller</strong> plugin.</p>
            <p>Open the Controller's settings to add, edit, or remove reminder rules.</p>
        `;let f=t("Debug",!1);new S.Setting(f).setName("Enable Logging").setDesc("Log detailed info to console").addToggle(a=>a.setValue(this.plugin.settings.enableLogging).onChange(async d=>{this.plugin.settings.enableLogging=d,await this.plugin.saveSettings()})),new S.Setting(f).setName("Send Test Notification").setDesc("Send a test notification to verify connection").addButton(a=>a.setButtonText("Send Test").onClick(async()=>{a.setButtonText("Sending..."),a.setDisabled(!0);try{await this.plugin.sendMessage("Test notification from TPS Notifier",void 0,"Test Notification"),new S.Notice("Test notification sent!")}catch(d){new S.Notice("Failed to send test notification")}a.setButtonText("Send Test"),a.setDisabled(!1)}))}renderSnoozeOptions(e){e.empty();let t=this.plugin.settings.snoozeOptions||[];t.forEach((s,i)=>{let r=new S.Setting(e).setName(`Preset ${i+1}`).addText(l=>l.setPlaceholder("Label").setValue(s.label).onChange(async u=>{s.label=u,await this.plugin.saveSettings()})).addText(l=>l.setPlaceholder("Minutes").setValue(String(s.minutes)).onChange(async u=>{let c=parseInt(u);!isNaN(c)&&c>0&&(s.minutes=c,await this.plugin.saveSettings())})).addExtraButton(l=>l.setIcon("trash").setTooltip("Remove").onClick(async()=>{t.splice(i,1),await this.plugin.saveSettings(),this.renderSnoozeOptions(e)}))})}};var y=require("obsidian");function O(o){if(!o)return null;let n=Array.isArray(o)?o[0]:o;if(!n)return null;if(n=String(n).replace(/[\[\]]/g,""),typeof n=="string"){let s=n.split(/\s+[-–]\s+/);if(s.length>1)n=s[0].trim();else{let r=n.match(/(\d{1,2}:\d{2})\s*[-–]\s*(\d{1,2}:\d{2})/);r&&(n=r[1])}let i=n.match(/(\d{4}-\d{2}-\d{2})(?:\s+(\d{1,2}:\d{2}(?:\s*[AP]M?)?))?/i);i&&(n=i[0])}let e=["YYYY-MM-DD HH:mm","YYYY-MM-DD H:mm","YYYY-MM-DD HH:mm A","YYYY-MM-DD h:mm A","YYYY-MM-DDTHH:mm:ss","YYYY-MM-DDTHH:mm","YYYY-MM-DD","HH:mm","H:mm","hh:mm A","h:mm A",y.moment.ISO_8601],t=(0,y.moment)(n,e,!0);if(t.isValid())return t.valueOf();if(/\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/.test(n)||/\d{1,2}:\d{2}/.test(n)){let s=y.moment.suppressDeprecationWarnings;y.moment.suppressDeprecationWarnings=!0;let i;try{i=(0,y.moment)(n)}finally{y.moment.suppressDeprecationWarnings=s}return i.isValid()?i.valueOf():null}return null}function G(o){if(!o)return{start:null,end:null};let n=Array.isArray(o)?o[0]:o;if(!n)return{start:null,end:null};n=String(n).replace(/[\[\]]/g,"");let e=n,t=null;if(typeof n=="string"){let r=n.split(/\s+[-–]\s+/);if(r.length>1)e=r[0].trim(),t=r[r.length-1].trim();else{let l=n.match(/\b(\d{1,2}:\d{2})\s*[-–]\s*(\d{1,2}:\d{2})\b/);l&&(t=l[2])}}let s=O(e);if(!s)return{start:null,end:null};let i=null;return t&&(/^\d{1,2}:\d{2}(?:\s*[AP]M?)?$/i.test(t)?(i=(0,y.moment)(s).set({hour:(0,y.moment)(t,["H:mm","HH:mm","h:mm A"],!0).hour(),minute:(0,y.moment)(t,["H:mm","HH:mm","h:mm A"],!0).minute()}).valueOf(),i<s&&(i=(0,y.moment)(i).add(1,"day").valueOf())):i=O(t)),{start:s,end:i}}function j(o){if(typeof o=="number")return o;if(!o)return 0;let n=String(o).trim().toLowerCase(),e=n.match(/(\d+(?:\.\d+)?)h/),t=n.match(/(\d+(?:\.\d+)?)m/),s=0;if(e&&(s+=parseFloat(e[1])*60),t&&(s+=parseFloat(t[1])),s>0)return s;let i=parseFloat(n);return isNaN(i)?0:i}function Q(o,n,e){if(n)return n;let t=[e==null?void 0:e.duration,e==null?void 0:e.timeEstimate];for(let i of t){let r=j(i);if(r>0)return o+r*60*1e3}let s=(e==null?void 0:e.end)||(e==null?void 0:e.endTime);if(s){let i=O(s);if(i)return i;if(/^\d{1,2}:\d{2}(?:\s*[AP]M?)?$/i.test(s)){let r=(0,y.moment)(o).set({hour:(0,y.moment)(s,["H:mm","HH:mm","h:mm A"],!0).hour(),minute:(0,y.moment)(s,["H:mm","HH:mm","h:mm A"],!0).minute()}).valueOf();return r<o&&(r=(0,y.moment)(r).add(1,"day").valueOf()),r}}return null}function J(o,n){var t;let e=o;for(let s in n)e=e.replace(new RegExp(`\\{${s}\\}`,"g"),String((t=n[s])!=null?t:""));return e}function X(o,n){let e=n.split(":");if(e.length<2)return!1;let t=e[0].trim(),s=e.slice(1).join(":").trim().toLowerCase(),i=o[t];return i==null?!1:String(i).toLowerCase()===s}function Y(o){return String(o!=null?o:"").trim().toLowerCase()}function Z(o){let n=o==null?void 0:o.status;if(Array.isArray(n))return n.map(t=>Y(t)).filter(Boolean);let e=Y(n);return e?[e]:[]}function ee(o,n){if(!n.requiredStatuses||n.requiredStatuses.length===0)return!0;let e=n.requiredStatuses.map(s=>Y(s)).filter(Boolean);return e.length===0?!0:Z(o).some(s=>e.includes(s))}function te(o,n,e,t,s,i,r){let l=Array.isArray(t.ignorePaths)?t.ignorePaths:s,u=Array.isArray(t.ignoreTags)?t.ignoreTags:i,c=Array.isArray(t.ignoreStatuses)?t.ignoreStatuses:r;if(l.some(g=>g&&o.path.startsWith(g)))return!0;let p=new Set(Z(e));return!!(c.map(g=>Y(g)).filter(Boolean).some(g=>p.has(g))||((n?(0,y.getAllTags)(n):[])||[]).some(g=>{let h=g.replace("#","").toLowerCase();return u.some(P=>{let E=String(P).toLowerCase().replace("#","").trim();return E?h===E||h.startsWith(E+"/"):!1})}))}var se={ntfyServer:"https://ntfy.sh",ntfyTopic:"",ntfyPriority:3,enableLogging:!1,snoozeProperty:"reminderSnooze",snoozeOptions:[{label:"15 Minutes",minutes:15},{label:"1 Hour",minutes:60},{label:"4 Hours",minutes:240},{label:"1 Day",minutes:1440}]},B=class extends T.Plugin{async onload(){M("[TPS Notifier] onload() started");try{try{let e=`${this.manifest.dir}/styles-ui.css`,t=await this.app.vault.adapter.read(e);this.register(()=>{var i;return(i=document.head.querySelector("style#tps-notifier-ui-styles"))==null?void 0:i.remove()});let s=document.head.createEl("style",{attr:{id:"tps-notifier-ui-styles"}});s.textContent=t}catch(e){console.warn("[TPS-Notifier] Failed to load styles-ui.css",e)}await this.loadSettings(),M("[TPS Notifier] Settings loaded"),this.registerView(z,e=>(M("[TPS Notifier] Creating new NotificationView instance"),new L(e,this))),this.addCommand({id:"open-notifications",name:"View Notifications",callback:()=>{this.openNotificationModal()}}),this.addCommand({id:"send-custom-notification",name:"Send Custom Notification",callback:()=>{this.openSendNotificationModal()}}),this.addRibbonIcon("bell","View Notifications",()=>{this.openNotificationModal()}),this.addSettingTab(new $(this.app,this)),this.registerObsidianProtocolHandler("tps-notifier",async e=>{M("[TPS Notifier] Protocol handler triggered",e),await this.openNotificationModal()}),this.api={sendNotification:(e,t,s)=>this.sendMessage(t,s,e),sendMessage:(e,t,s)=>this.sendMessage(e,t,s),getOverdueItems:()=>this.getOverdueItems(),snoozeFile:(e,t)=>this.snoozeFile(e,t),markFileComplete:e=>this.markFileComplete(e),markFileWontDo:e=>this.markFileWontDo(e)}}catch(e){C("[TPS Notifier] Failed to load plugin:",e),new T.Notice("TPS Notifier failed to load. Check console.")}M("[TPS Notifier] onload() completed")}onunload(){M("[TPS Notifier] onunload()"),delete this.api}async openNotificationModal(){let{workspace:e}=this.app,t=null,s=e.getLeavesOfType(z);if(s.length>0)t=s[0];else{let i=e.getRightLeaf(!1);i?(t=i,await t.setViewState({type:z,active:!0})):C("[TPS Notifier] Failed to get right leaf")}t?e.revealLeaf(t):C("[TPS Notifier] leaf is null, cannot reveal")}async loadSettings(){try{let e=await this.loadData();this.settings=Object.assign({},se,e),this.settings.enableLogging&&_(!0)}catch(e){C("[TPS Notifier] Error in loadSettings:",e),this.settings=JSON.parse(JSON.stringify(se))}}async saveSettings(){_(this.settings.enableLogging),await this.saveData(this.settings)}log(e,...t){M(`[TPS Notifier] ${e}`,...t)}buildObsidianLink(e){if(!e)return"";let t=encodeURIComponent(this.app.vault.getName()),s=encodeURIComponent(e.path);return`obsidian://tps-notifier?vault=${t}&file=${s}`}getNtfyUrl(){let e=(this.settings.ntfyServer||"").replace(/\/+$/,""),t=(this.settings.ntfyTopic||"").trim();return!e||!t?null:`${e}/${t}`}async sendMessage(e,t,s){let i=this.getNtfyUrl();if(!i){new T.Notice("Configure ntfy server and topic first.");return}let r=this.buildObsidianLink(t),u={"Content-Type":"text/plain; charset=utf-8",Title:(s||"TPS Notifier").replace(/[^\x00-\xFF]/g,""),Priority:String(this.settings.ntfyPriority||3),Markdown:"yes"};r&&(u.Click=r);try{let c=await fetch(i,{method:"POST",headers:u,body:e||"(empty message)"});if(c.ok)this.log(`Notification sent: ${s}`);else{let p=await c.text();C("[TPS Notifier] Ntfy error:",p)}}catch(c){C("[TPS Notifier] Failed to send notification:",c)}}get globalIgnorePaths(){return Array.isArray(this.settings.ignorePaths)?this.settings.ignorePaths:[]}get globalIgnoreTags(){return Array.isArray(this.settings.ignoreTags)?this.settings.ignoreTags:[]}get globalIgnoreStatuses(){return Array.isArray(this.settings.ignoreStatuses)?this.settings.ignoreStatuses:[]}async getOverdueItems(){var u;let e=Date.now(),t=[],s=[];try{let c=this.app.plugins.getPlugin("tps-controller");(u=c==null?void 0:c.api)!=null&&u.getReminders&&(s=c.api.getReminders()||[])}catch(c){}if(!s.length&&this.settings.reminders&&(s=this.settings.reminders),!s.length)return t;let i=this.app.vault.getMarkdownFiles();for(let c of i){let p=this.app.metadataCache.getFileCache(c),f=(p==null?void 0:p.frontmatter)||{};for(let a of s){if(!a.enabled||te(c,p,f,a,this.globalIgnorePaths,this.globalIgnoreTags,this.globalIgnoreStatuses)||!ee(f,a))continue;let d,g=f[this.settings.snoozeProperty||"reminderSnooze"];if(g){let x=O(g);x&&e<x&&(d=x)}let h=f[a.property],{start:P,end:E}=G(h);if(!P)continue;let m=Q(P,E,f);if(a.mode==="timeblock"&&m&&!a.triggerAtEnd&&e>m||a.stopConditions.some(x=>X(f,x)))continue;let k=P;if(a.triggerAtEnd&&m&&(k=m),(f.allDay===!0||String(f.allDay).toLowerCase()==="true")&&a.allDayBaseTime){let x=a.allDayBaseTime.match(/^(\d{1,2}):(\d{2})$/);if(x){let[w,b,F]=x;k=(0,T.moment)(k).set({hour:parseInt(b,10),minute:parseInt(F,10),second:0,millisecond:0}).valueOf()}}let V=a.offsetMinutes*60*1e3;if(a.useSmartOffset&&a.smartOffsetProperty){let x=f[a.smartOffsetProperty],b=j(x)*60*1e3;a.smartOffsetOperator==="add"?V=b:V=-b}let ie=k+V;if(e>=ie){let x=e-k,w=Math.floor(x/6e4),b="";if(w<0){let D=Math.abs(w);if(D<60)b=`in ${D} min`;else if(D<1440)b=`in ${Math.floor(D/60)}h ${D%60}m`;else{let W=Math.floor(D/1440),U=Math.floor(D%1440/60),re=D%60;b=`in ${W}d ${U}h ${re}m`}}else if(w<60)b=`${w} min ago`;else if(w<1440)b=`${Math.floor(w/60)}h ${w%60}m ago`;else{let D=Math.floor(w/1440),W=Math.floor(w%1440/60),U=w%60;b=`${D}d ${W}h ${U}m ago`}let F={filename:c.basename,time:(0,T.moment)(k).format("HH:mm"),remaining:b,duration:f.duration||""},ne=J(a.title,F),oe=J(a.body,F);t.push({file:c,reminder:a,propertyTime:k,diff:b,id:a.id,title:ne,body:oe,snoozedUntil:d})}}}t.sort((c,p)=>c.propertyTime-p.propertyTime);let r=new Set,l=[];for(let c of t){let p=c.file.path;r.has(p)||(r.add(p),l.push(c))}return l}async listOverdueItems(){new H(this.app,this).open()}async snoozeFile(e,t){let s="";t>0&&(s=(0,T.moment)().add(t,"minutes").format("YYYY-MM-DD HH:mm")),await this.app.fileManager.processFrontMatter(e,i=>{let r=this.settings.snoozeProperty||"reminderSnooze";i[r]=s})}openFile(e){let t=this.app.workspace.getLeaf(!1);t&&t.openFile(e)}async markFileComplete(e){await this.app.fileManager.processFrontMatter(e,t=>{t.status="complete"})}async markFileWontDo(e){await this.app.fileManager.processFrontMatter(e,t=>{t.status="wont-do"})}openSendNotificationModal(){new class extends T.Modal{constructor(s,i){super(s);this.title="";this.body="";this.plugin=i}onOpen(){let{contentEl:s}=this;s.empty(),s.createEl("h2",{text:"Send Custom Notification"});let i=s.createDiv();i.style.display="flex",i.style.flexDirection="column",i.style.gap="10px";let r=i.createDiv();r.createEl("label",{text:"Title",cls:"tps-notifier-label"});let l=r.createEl("input",{type:"text",placeholder:"Notification Title"});l.style.width="100%",l.addEventListener("input",d=>this.title=d.target.value);let u=i.createDiv();u.createEl("label",{text:"Message",cls:"tps-notifier-label"});let c=u.createEl("textarea",{placeholder:"Message Body"});c.style.width="100%",c.rows=4,c.addEventListener("input",d=>this.body=d.target.value);let p=i.createDiv();p.style.display="flex",p.style.justifyContent="flex-end",p.style.marginTop="15px",p.style.gap="10px",p.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),p.createEl("button",{text:"Send",cls:"mod-cta"}).addEventListener("click",async()=>{if(!this.title&&!this.body){new T.Notice("Please provide a title or message body.");return}await this.plugin.sendMessage(this.body,void 0,this.title),new T.Notice("Notification Sent"),this.close()})}onClose(){this.contentEl.empty()}}(this.app,this).open()}};
